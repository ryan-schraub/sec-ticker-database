<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEC Financial Filing Dashboard</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: #f0f2f5; color: #1c1e21; }
        
        /* Navigation Style */
        .navbar { background: #003366 !important; margin-bottom: 20px; }
        .navbar-brand, .nav-link { color: white !important; }
        .nav-link:hover { opacity: 0.8; }
        .nav-link.active { font-weight: bold; border-bottom: 2px solid white; }

        .wrapper { max-width: 1300px; margin: auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 30px rgba(0,0,0,0.1); }
        h1 { color: #003366; font-weight: 700; margin-bottom: 20px; }
        
        #search { width: 100%; padding: 15px; margin-bottom: 25px; border: 1px solid #ccd0d5; border-radius: 8px; font-size: 18px; outline: none; }
        #search:focus { border-color: #003366; box-shadow: 0 0 5px rgba(0,51,102,0.2); }

        table { width: 100%; border-collapse: collapse; }
        th { background: #003366; color: white; padding: 15px; text-align: left; }
        td { padding: 12px; border-bottom: 1px solid #ebedf0; vertical-align: middle; }
        
        .btn-custom { text-decoration: none; color: white; padding: 6px 12px; border-radius: 6px; font-size: 12px; font-weight: bold; display: inline-block; }
        .btn-k { background: #1a73e8; }
        .btn-q { background: #8e44ad; }
        .btn-analysis { background: #e67e22; } /* Orange for Analysis */
        
        .date { font-family: 'Courier New', Courier, monospace; color: #555; font-size: 14px; }
        .footer-info { margin-top: 20px; text-align: center; color: #666; font-size: 0.9rem; }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">ðŸ“Š SEC Filer Dashboard</a>
            <div class="collapse navbar-collapse">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item"><a class="nav-link active" href="index.html">Master Matrix</a></li>
                    <li class="nav-item"><a class="nav-link" href="archive.html">Daily Archives</a></li>
                </ul>
                <span class="navbar-text text-white small">
                    System Status: <span class="badge bg-success">Online</span>
                </span>
            </div>
        </div>
    </nav>

    <div class="wrapper">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h1>Market Analysis Matrix</h1>
            <span id="update-timestamp" class="text-muted small"></span>
        </div>
        
        <input type="text" id="search" placeholder="Quick Search: Ticker, Company, or Keyword..." onkeyup="runSearch()">
        
        <div class="table-responsive">
            <table id="filingTable">
                <thead>
                    <tr>
                        <th>Ticker</th>
                        <th>Company Name</th>
                        <th>Latest 10-K</th>
                        <th>Actions</th>
                        <th>Latest 10-Q</th>
                        <th>Analysis</th>
                    </tr>
                </thead>
                <tbody>
                    </tbody>
            </table>
        </div>
        
        <div class="footer-info">
            Data sourced from SEC EDGAR. Automated reporting cycle active.
        </div>
    </div>

    <script>
        async function init() {
            // Display last modified date of the CSV
            const timestampElement = document.getElementById('update-timestamp');
            
            try {
                const response = await fetch('tickers_preview.csv');
                if (!response.ok) throw new Error("CSV not found");
                
                const csv = await response.text();
                
                // Set "Last Updated" text
                timestampElement.innerText = `Data Pulse: ${new Date().toLocaleDateString()} ${new Date().toLocaleTimeString()}`;

                Papa.parse(csv, {
                    header: true,
                    skipEmptyLines: true,
                    complete: (results) => {
                        const tbody = document.querySelector('#filingTable tbody');
                        results.data.forEach(row => {
                            const tr = document.createElement('tr');
                            
                            const kLink = row['10-K Link'] ? `<a class="btn-custom btn-k" href="${row['10-K Link']}" target="_blank">View 10-K</a>` : 'â€”';
                            const qLink = row['10-Q Link'] ? `<a class="btn-custom btn-q" href="${row['10-Q Link']}" target="_blank">View 10-Q</a>` : 'â€”';
                            
                            // Check if company is RTX for the "Deep Dive" button demo
                            const analysisBtn = (row.Ticker === 'RTX') 
                                ? `<a class="btn-custom btn-analysis" href="rtx-analysis.html">REVENUE BRIDGE</a>` 
                                : `<span class="text-muted small">Pending...</span>`;
                            
                            tr.innerHTML = `
                                <td><span class="badge bg-dark">${row.Ticker}</span></td>
                                <td>${row.Company}</td>
                                <td class="date">${row['Latest 10-K'] || 'N/A'}</td>
                                <td>${kLink}</td>
                                <td class="date">${row['Latest 10-Q'] || 'N/A'}</td>
                                <td>${analysisBtn}</td>
                            `;
                            tbody.appendChild(tr);
                        });
                    }
                });
            } catch (err) {
                console.error("Initialization Error:", err);
                timestampElement.innerText = "Error loading data pulsate.";
            }
        }

        function runSearch() {
            const query = document.getElementById('search').value.toUpperCase();
            document.querySelectorAll('#filingTable tbody tr').forEach(row => {
                row.style.display = row.innerText.toUpperCase().includes(query) ? '' : 'none';
            });
        }

        init();
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
